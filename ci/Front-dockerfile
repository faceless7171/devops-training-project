FROM node:13.3.0-alpine3.10 AS builder

COPY frontend /app
WORKDIR /app

RUN npm i \
  && CI=true npm test \
  && CI=true npm run build

FROM nginx:1.17.6-alpine as dev

COPY --from=builder --chown=nginx /app/build /var/www/html
COPY --chown=nginx front-nginx /etc/nginx/sites-available/default

EXPOSE 80

RUN nginx -s reload