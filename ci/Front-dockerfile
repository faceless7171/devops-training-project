FROM node:13.3.0-alpine3.10 AS builder

COPY frontend /app
WORKDIR /app

RUN npm i \
  && CI=true npm test \
  && CI=true npm run build

FROM nginx:1.12-alpine as dev

COPY --from=builder /app/build /var/www/html
COPY ci/front-nginx /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]